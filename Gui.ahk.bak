
/** Class Gui
*/
Class Gui{

	_gui := new VilGUI("TabsSwitcher")
	
	/** tabsetManager
	*/
	managerGui()
	{
		;this._createMenuBar()

		this._gui.Events.Gui.onSubmit(this._Parent ".onSubmit")
		
		this._gui.Controls
			.GroupBox("Manage").add()
		
		this._gui.Controls
			.Edit()
				.value( this.parent()._TargetInfo._root_path )					
				.label("Root")				
				.options("w512")
				.add()
			.section()
			
			.Edit()
				.value( this.parent()._TargetInfo._unique_file )					
				.label("Unique file")				
				;.options("w512")
				.add()		
			.Dropdown()
				.label("TabSet")
				.items( this.parent()._getTabsets() )
				.add()				
			.Dropdown()
				.label("Tabs")
				.items(this.parent()._getTabs())
				.add()
			.section()

		this._gui.create()
	}
	/** tabsetLoaderGui
	 */
	tabsetLoaderGui()
	{
		
		
		this._addTabsetControls()
		this._addTabs()		
			

			;.GroupBox("Load Tabs").add()
			;	.Dropdown()
			;		.label("TabSet")
			;		.callback( &this "._tabsetChanged" )
			;		.items( this._TabsetInfo()._getTabsetsNames() )
			;		.checked( this._TargetInfo()._tabset_current )					
			;		.add("TabSet")
			;	.Dropdown()
			;		.label("Folders")
			;		.items( this._TabsetInfo()._getFolderNames(this._TargetInfo()._tabset_current) )
			;		.add("Folders")
			;	.section()

		;this._gui.Controls.section()
			;.Button().callback( "loadTabsCallback" ).options("h48 w256").value( "load" ).add("btnLoadTabs")
		;this._addTabsButtons()		
		this._gui.create()
	}
	/**
	 */
	_addTabsetControls()
	{
		this._gui.controls.layout("row")
			;.Text("Current: " this._TargetInfo().get("folder_current") ).add()
			.Dropdown()
				.label("Action")
				;.callback( &this "._tabsetChanged", $tab_name )
				.items( "New||Rename|Delete" )
				.checked( this._Tabset($tab_name).get("last_active") )					
				.add("RootAction")
				
		.section()
	}
	/**
	 */
	_addTabs()
	{
		$tabset_names	:= this._TabsetInfo()._getTabsetsNames()
		this._Tabs	:= this._gui.Tabs( $tabset_names ).add("TabsetTabs").get()
		For $i, $tabset_name in $tabset_names
			this._addTab( $i, $tabset_name )

	} 
	/**
	 */
	_addTab( $index, $tab_name )
	{
		this._Tabs.Tabs[$index].Controls
			.GroupBox("TabSet").add("GBTabSet")
			.Dropdown()
				.callback( &this "._tabsetChanged", $tab_name )
				.items( this._Tabset($tab_name)._getFolderNames() )
				.checked( this._Tabset($tab_name).get("last_active") )					
				.add("TabSet")
			.Dropdown()
				.label("Action")
				;.callback( &this "._tabsetChanged", $tab_name )
				.items( "New||Rename|Delete" )
				.checked( this._Tabset($tab_name).get("last_active") )					
				.add("TabsetAction")
			
		
			.groupEnd()
			;.section()			
		this._addTabsListControls($index, $tab_name)
	}
	/**
	 */
	_addTabsListControls( $index, $tab_name )
	{
		this._Tabs.Tabs[$index].Controls
			.ListBox().items( this._Tabset($tab_name)._getTabFiles("_common") ).label("Tabs").add("TabsList" $tab_name)		

	} 
	
	
	
	
	/**
	 */
	_addTabsButtons()
	{
		;For $t, $tab in % this.parent()._getTabs()
			;this._gui.Controls.Button().callback( this._Parent ".loadTabs" ).options("h48 w96").value($tab).add("btn-tab-" $tab)			
			;this._gui.Controls.Button().submit($tab)		
	}
	/**
	 */
	_setDropdownItems($control_name, $items, $selected:="")
	{
		this._gui.Controls.get($control_name)
							.clear()
							.edit($items)
	} 
	/**
	 */
	_getControlValue($control_name)
	{
		return % this._gui.Controls.get($control_name).value()
	} 

	/*---------------------------------------
		CALLBACKS
	-----------------------------------------
	*/
	/**
	 */
	_tabsetChanged( $Event, $tabset_name )
	{
		;$Event.message()
		$tabfiles_new	:= $Event.control().value()		
		$tab	:= this._gui.controls.get("TabsetTabs").getActive(  )
		$TabsList	:= $tab.Controls.get("TabsList" $tabset_name).clear().edit( this._Tabset($tabset_name)._getTabFiles($tabfiles_new) )
	}
	/*---------------------------------------
		PARENT ACCESS
	-----------------------------------------
	*/
	/** set\get parent class
	 * @return object parent class
	*/
	parent($Parent:=""){
		if($Parent)
			this._Parent	:= &$Parent
		return % $Parent ? this : Object(this._Parent)
	}
	/**
	 */
	_TabsetInfo()
	{
		return % this.parent()._TabsetInfo
	}
	/**
	 */
	_Tabset($name)
	{
		return % this._TabsetInfo().getTabset($name)
	}
	/**
	 */
	_TargetInfo()
	{
		return % this.parent()._TargetInfo
	} 
	
	
}

